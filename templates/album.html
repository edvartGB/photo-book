{% extends "base.html" %}
{% block title %}{{ album['name'] }} - Photo Book{% endblock %}

{% block content %}
<div class="page-header">
    <h1 id="album-title" class="editable-title" title="Click to rename">{{ album['name'] }}</h1>
    <form method="POST" action="{{ url_for('rename_album', album_id=album['id']) }}" id="rename-form" class="rename-form" hidden>
        <input type="text" name="name" value="{{ album['name'] }}" id="rename-input" class="rename-input">
        <button type="submit">Save</button>
        <button type="button" id="rename-cancel">Cancel</button>
    </form>
    <div class="page-header-actions">
        <a href="{{ url_for('add_photos_to_album', album_id=album['id']) }}">Add photos</a>
        <form method="POST" action="{{ url_for('delete_album', album_id=album['id']) }}" class="inline-form"
              onsubmit="return confirm(this.delete_photos.checked ? 'Delete this album AND all its photos? This cannot be undone.' : 'Delete this album? Photos will be kept.')">
            <label class="delete-photos-label"><input type="checkbox" name="delete_photos" value="1"> Delete photos too</label>
            <button type="submit" class="btn-danger">Delete album</button>
        </form>
    </div>
</div>

{% if photos %}
<div class="photo-grid">
    {% for photo in photos %}
    <a href="{{ url_for('photo', photo_id=photo['id']) }}" class="photo-card">
        <img src="{{ url_for('serve_thumbnail', filename=photo['filename']) }}" alt="{{ photo['caption'] or photo['original_name'] }}" loading="lazy">
        {% if photo['caption'] %}
        <span class="photo-caption">{{ photo['caption'][:30] }}{% if photo['caption']|length > 30 %}...{% endif %}</span>
        {% endif %}
    </a>
    {% endfor %}
</div>

<div class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for('album', album_id=album['id'], page=page-1) }}">&larr; Newer</a>
    {% endif %}
    {% if has_next %}
    <a href="{{ url_for('album', album_id=album['id'], page=page+1) }}">Older &rarr;</a>
    {% endif %}
</div>
{% else %}
<p class="empty">this album is empty. <a href="{{ url_for('upload_page') }}">upload some photos!</a></p>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
const title = document.getElementById("album-title");
const form = document.getElementById("rename-form");
const input = document.getElementById("rename-input");
const cancel = document.getElementById("rename-cancel");

title.addEventListener("click", () => {
    title.hidden = true;
    form.hidden = false;
    input.focus();
    input.select();
});

cancel.addEventListener("click", () => {
    form.hidden = true;
    title.hidden = false;
});
</script>
{% endblock %}
